#!/bin/bash
MODE=$1
HOSTS_IPS=$2

echo -e ${HOSTS_IPS//'n'/'\n'} > hosts

if [[ $MODE == 'create-cluster' ]]; then
  ansible-playbook -i /ansible/hosts /ansible/create-swarm-cluster.yml
fi

if [[ $MODE == 'deploy' ]]; then
  GITHUB_TOKEN=$3
  OWNER=$4
  REPO=$5
  ENV_NAME=$6
  DOCKER_PASS=$7
  DOCKER_USER=$8

  echo $ENV_NAME

  ansible-playbook -i /ansible/hosts /ansible/deploy-stack.yml --extra-var "github_token=$GITHUB_TOKEN repo_owner=$OWNER repo_name=$REPO env_name=$ENV_NAME docker_pass=$DOCKER_PASS docker_user=$DOCKER_USER"
fi